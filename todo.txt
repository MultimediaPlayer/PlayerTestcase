- seg / offset sync

- check event (use inband)
	
- docouple lic / eme from mvid

- small end segs
- seg timeline mpd

jslint

- AVC  [DASH] Could not merge AVC|H264 SPS from different files (same SPS ID used) - disabling bitstream switching
	- ask GPAC and BBC!!!!
	- try multi instead of inband!!!  bad!!!!

- sanity check mpd using dash site (http://dashif.org/conformance.html)

- code review player - jslint
- create dash conf page




Confluence
- Create DASH
- Encrypt dash
- Add events
- Timestamp content
- Clone dash



Qs
--------------------

Send manifest to check!
EBU-TT D comment

1. live playback
2. start of current live programme
3. trick mode?
4. cue signalling
5. how large / how many periods?
6. how many time will it polled etc?
7. trickmode?  or just live and beginning?






----------- LOG ---------------


Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Users\Mark Work>cd Documents\DUK\DASH\content\bbb

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\ffmpeg.exe.lnk -i video_only.mp4 -s 1280x720 -c:v libx264 -b:v 2594k -r 25 -x264opts keyint=96:min-keyint=96:no-scenecut -profile:v main -preset fast -movflags +faststart int_2656696.mp4
ffmpeg version N-86994-g92da230 Copyright (c) 2000-2017 the FFmpeg developers
  built with gcc 7.1.0 (GCC)
  configuration: --enable-gpl --enable-version3 --enable-cuda --enable-cuvid --enable-d3d11va --enable-dxva2 --enable-libmfx --enable-nvenc --enable-avisynth --enable-bzlib --enable-fontconfig --enable-frei0r --enable-gnutls --enable-iconv --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libfreetype --enable-libgme --enable-libgsm --enable-libilbc --enable-libmodplug --enable-libmp3lame --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopus --enable-librtmp --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvo-amrwbenc --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxavs --enable-libxvid --enable-libzimg --enable-lzma --enable-zlib
  libavutil      55. 74.100 / 55. 74.100
  libavcodec     57.102.100 / 57.102.100
  libavformat    57. 76.100 / 57. 76.100
  libavdevice    57.  7.100 / 57.  7.100
  libavfilter     6. 99.100 /  6. 99.100
  libswscale      4.  7.102 /  4.  7.102
  libswresample   2.  8.100 /  2.  8.100
  libpostproc    54.  6.100 / 54.  6.100
Input #0, mov,mp4,m4a,3gp,3g2,mj2, from 'video_only.mp4':
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    title           : Big Buck Bunny, Sunflower version
    artist          : Blender Foundation 2008, Janus Bager Kristensen 2013
    composer        : Sacha Goedegebure
    encoder         : Lavf57.76.100
    comment         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
    genre           : Animation
  Duration: 01:03:27.27, start: 0.000000, bitrate: 2901 kb/s
    Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 1920x1080 [SAR 1:1 DAR 16:9], 2898 kb/s, 30 fps, 30 tbr, 15360 tbn, 60 tbc (default)
    Metadata:
      handler_name    : VideoHandler
Stream mapping:
  Stream #0:0 -> #0:0 (h264 (native) -> h264 (libx264))
Press [q] to stop, [?] for help
[libx264 @ 0000000002d10a20] using SAR=1/1
[libx264 @ 0000000002d10a20] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX
[libx264 @ 0000000002d10a20] profile Main, level 3.1
[libx264 @ 0000000002d10a20] 264 - core 152 r2851 ba24899 - H.264/MPEG-4 AVC codec - Copyleft 2003-2017 - http://www.videolan.org/x264.html - options: cabac=1 ref=2 deblock=1:0:0 analyse=0x1:0x111 me=hex subme=6 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=0 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=6 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=1 keyint=96 keyint_min=49 scenecut=0 intra_refresh=0 rc_lookahead=30 rc=abr mbtree=1 bitrate=2594 ratetol=1.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00
Output #0, mp4, to 'int_2656696.mp4':
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    title           : Big Buck Bunny, Sunflower version
    artist          : Blender Foundation 2008, Janus Bager Kristensen 2013
    composer        : Sacha Goedegebure
    genre           : Animation
    comment         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
    encoder         : Lavf57.76.100
    Stream #0:0(und): Video: h264 (libx264) (avc1 / 0x31637661), yuv420p, 1280x720 [SAR 1:1 DAR 16:9], q=-1--1, 2594 kb/s, 25 fps, 12800 tbn, 25 tbc (default)
    Metadata:
      handler_name    : VideoHandler
      encoder         : Lavc57.102.100 libx264
    Side data:
      cpb: bitrate max/min/avg: 0/0/2594000 buffer size: 0 vbv_delay: -1
Past duration 0.666664 too large
Past duration 0.833321 too large
Past duration 0.999992 too large
[mp4 @ 00000000006147c0] Starting second pass: moving the moov atom to the beginning of the file34 speed=0.402x
frame=95183 fps= 10 q=-1.0 Lsize= 1211832kB time=01:03:27.20 bitrate=2607.5kbits/s dup=0 drop=19035 speed=0.401x
video:1210731kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.090944%
[libx264 @ 0000000002d10a20] frame I:992   Avg QP:13.63  size:171615
[libx264 @ 0000000002d10a20] frame P:30833 Avg QP:17.95  size: 25769
[libx264 @ 0000000002d10a20] frame B:63358 Avg QP:21.98  size:  4341
[libx264 @ 0000000002d10a20] consecutive B-frames:  6.3% 11.8%  8.6% 73.2%
[libx264 @ 0000000002d10a20] mb I  I16..4: 19.0%  0.0% 81.0%
[libx264 @ 0000000002d10a20] mb P  I16..4:  3.3%  0.0%  6.9%  P16..4: 27.6% 13.3%  8.6%  0.0%  0.0%    skip:40.3%
[libx264 @ 0000000002d10a20] mb B  I16..4:  1.1%  0.0%  1.1%  B16..8: 13.5%  5.2%  0.6%  direct: 5.5%  skip:73.2%  L0:40.1% L1:47.4% BI:12.5%
[libx264 @ 0000000002d10a20] final ratefactor: 18.93
[libx264 @ 0000000002d10a20] coded y,uvDC,uvAC intra: 64.0% 74.0% 52.1% inter: 10.6% 13.2% 1.7%
[libx264 @ 0000000002d10a20] i16 v,h,dc,p: 39% 23% 12% 25%
[libx264 @ 0000000002d10a20] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 24% 18% 12%  6%  9% 10%  7%  7%  6%
[libx264 @ 0000000002d10a20] i8c dc,h,v,p: 49% 22% 17% 11%
[libx264 @ 0000000002d10a20] Weighted P-Frames: Y:3.4% UV:2.3%
[libx264 @ 0000000002d10a20] ref P L0: 78.2% 21.8%
[libx264 @ 0000000002d10a20] ref B L0: 86.0% 14.0%
[libx264 @ 0000000002d10a20] ref B L1: 95.9%  4.1%
[libx264 @ 0000000002d10a20] kb/s:2605.06

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -frag-rap -bs-switching inband -profile dashavc264:live -segment-name $RepresentationID$-$Bandwidth$/SEG$Number$ -out bbb-clear.mpd aac-audio.m4a int_4741120.mp4 int_1416688.mp4 int_843768.mp4 int_449480.mp4 int_2656696.mp4
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments and fragments at GOP boundaries
DASHing file aac-audio.m4a
DASHing file int_4741120.mp4
DASHing file int_1416688.mp4
DASHing file int_843768.mp4
DASHing file int_449480.mp4
DASHing file int_2656696.mp4
[DASH] Generating MPD at time 2017-08-30T12:07:42.431Z

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -frag-rap -bs-switching inband -single-file int_4741120.mp4 int_1416688.mp4 int_843768.mp4 int_449480.mp4 int_2656696.mp4
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments and fragments at GOP boundaries
DASHing file int_4741120.mp4
DASHing file int_1416688.mp4
DASHing file int_843768.mp4
DASHing file int_449480.mp4
DASHing file int_2656696.mp4
[DASH] Generating MPD at time 2017-08-30T12:25:35.641Z

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml aac-audio.m4a -out encr_audio.m4a
Setting up iTunes/iPod file...
Saving to encr_audio.m4a: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_4741120_dash.mp4 -out encr_4741120.mp4
Saving to encr_4741120.mp4: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_1416688_dash.mp4 -out encr_1416688.mp4
Saving to encr_1416688.mp4: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_1416688_dash.mp4 -out encr_1416688.mp4

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_843768_dash.mp4 -out encr_843768.mp4
Saving to encr_843768.mp4: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_843768_dash.mp4 -out encr_843768.mp4^X^X^X
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_449480_dash.mp4 -out encr_449480.mp4
Saving to encr_449480.mp4: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\mp4box.exe.lnk -crypt crypt.xml int_2656696_dash.mp4 -out encr_2656696.mp4
Saving to encr_2656696.mp4: 0.500 secs Interleaving

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -bs-switching inband -profile dashavc264:live -segment-name ENC-$RepresentationID$-$Bandwidth$/SEG$Number$ -out bbb-clearkey.mpd encr_4741120.mp4 encr_1416688.mp4 encr_843768.mp4 encr_449480.mp4 encr_2656696.mp4 encr_audio.m4a
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments at GOP boundaries
[DASH] Could not merge AVC|H264 SPS from different files (same SPS ID used) - disabling bitstream switching
DASHing file encr_4741120.mp4
DASHing file encr_1416688.mp4
DASHing file encr_843768.mp4
DASHing file encr_449480.mp4
DASHing file encr_2656696.mp4
DASHing file encr_audio.m4a
[DASH] Generating MPD at time 2017-08-30T12:57:40.262Z

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -frag-rap -bs-switching inband -profile dashavc264:live -segment-name ENC-$RepresentationID$-$Bandwidth$/SEG$Number$ -out bbb-clearkey.mpd encr_4741120.mp4 encr_1416688.mp4 encr_843768.mp4 encr_449480.mp4 encr_2656696.mp4 encr_audio.m4a
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments and fragments at GOP boundaries
[DASH] Could not merge AVC|H264 SPS from different files (same SPS ID used) - disabling bitstream switching
DASHing file encr_4741120.mp4
^CO File Fragmenting: |                    | (03/100)
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -frag-rap -bs-switching inband -profile dashavc264:live -segment-name ENC-$RepresentationID$-$Bandwidth$/SEG$Number$ -out bbb-clearkey.mpd encr_4741120.mp4 encr_1416688.mp4 encr_843768.mp4 encr_449480.mp4 encr_2656696.mp4
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments and fragments at GOP boundaries
[DASH] Could not merge AVC|H264 SPS from different files (same SPS ID used) - disabling bitstream switching
DASHing file encr_4741120.mp4
^CO File Fragmenting: |=                   | (05/100)
C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>..\..\MP4Box.exe.lnk -dash 3840 -rap -bs-switching inband -profile dashavc264:live -segment-name ENC-$RepresentationID$-$Bandwidth$/SEG$Number$ -out bbb-clearkey.mpd encr_4741120.mp4 encr_1416688.mp4 encr_843768.mp4 encr_449480.mp4 encr_2656696.mp4 encr_audio.m4a
DASH-ing files: 3.84s segments 3.84s fragments single sidx per segment
Spliting segments at GOP boundaries
[DASH] Could not merge AVC|H264 SPS from different files (same SPS ID used) - disabling bitstream switching
DASHing file encr_4741120.mp4
DASHing file encr_1416688.mp4
DASHing file encr_843768.mp4
DASHing file encr_449480.mp4
DASHing file encr_2656696.mp4
DASHing file encr_audio.m4a
[DASH] Generating MPD at time 2017-08-30T13:25:32.664Z

C:\Users\Mark Work\Documents\DUK\DASH\content\bbb>